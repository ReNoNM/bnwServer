<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Calendar & Time Manager Test</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .connection-panel {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 20px;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"],
      input[type="number"] {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }

      button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .status {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        margin-left: 10px;
      }

      .status.connected {
        background: #4caf50;
        color: white;
      }

      .status.disconnected {
        background: #f44336;
        color: white;
      }

      .calendar-display {
        text-align: center;
        font-size: 48px;
        font-weight: bold;
        color: #667eea;
        margin: 20px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .calendar-info {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 20px 0;
      }

      .info-item {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .info-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 20px;
        font-weight: bold;
        color: #333;
      }

      .countdown {
        color: #667eea;
      }

      .auth-panel {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .auth-panel input {
        width: 100%;
        box-sizing: border-box;
      }

      .settings-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px 0;
      }

      .setting-item {
        display: flex;
        flex-direction: column;
      }

      .setting-item label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 20px;
      }

      .stat-item {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
      }

      .task-panel {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .task-list {
        margin-top: 15px;
      }

      .task-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 5px;
        margin-bottom: 5px;
      }

      #messages {
        max-height: 300px;
        overflow-y: auto;
        margin-top: 15px;
      }

      .message {
        padding: 8px;
        margin-bottom: 5px;
        border-left: 3px solid #2196f3;
        background: #e3f2fd;
        border-radius: 3px;
        font-size: 14px;
      }

      .message.error {
        border-left-color: #f44336;
        background: #ffebee;
      }

      .message.success {
        border-left-color: #4caf50;
        background: #e8f5e9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üóìÔ∏è Game Calendar & Time Manager Test</h1>

      <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ -->
      <div class="card">
        <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
        <div class="connection-panel">
          <input type="text" id="serverUrl" value="ws://localhost:8080" placeholder="WebSocket URL" style="flex: 1" />
          <button id="connectBtn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
          <button id="disconnectBtn" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
          <span class="status disconnected" id="connectionStatus">–û—Ç–∫–ª—é—á–µ–Ω–æ</span>
        </div>
      </div>

      <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
      <div class="card" id="authCard" style="display: none">
        <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div class="auth-panel">
          <div>
            <h3>–í—Ö–æ–¥</h3>
            <input type="email" id="loginEmail" placeholder="Email" />
            <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="margin-top: 10px" />
            <button id="loginBtn" style="margin-top: 10px; width: 100%">–í–æ–π—Ç–∏</button>
          </div>
          <div>
            <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input type="email" id="registerEmail" placeholder="Email" />
            <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="margin-top: 10px" />
            <button id="registerBtn" style="margin-top: 10px; width: 100%">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
          </div>
        </div>
      </div>

      <!-- –ò–≥—Ä–æ–≤–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
      <div class="card" id="calendarCard" style="display: none">
        <h2>üìÖ –ò–≥—Ä–æ–≤–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
        <div class="calendar-display" id="calendarDisplay">–ì–æ–¥ 1, –ú–µ—Å—è—Ü 1, –î–µ–Ω—å 1</div>
        <div class="calendar-info">
          <div class="info-item">
            <div class="info-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
            <div class="info-value" id="lastUpdate">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —á–µ—Ä–µ–∑</div>
            <div class="info-value countdown" id="nextDayCountdown">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">–í—Å–µ–≥–æ –¥–Ω–µ–π –ø—Ä–æ–π–¥–µ–Ω–æ</div>
            <div class="info-value" id="totalDays">0</div>
          </div>
        </div>

        <div style="margin-top: 20px">
          <button id="getDateBtn">–ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É</button>
          <button id="getCycleStatsBtn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è</button>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–ê–¥–º–∏–Ω) -->
        <div style="margin-top: 30px; border-top: 2px solid #ddd; padding-top: 20px">
          <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–ê–¥–º–∏–Ω)</h3>
          <div class="settings-grid">
            <div class="setting-item">
              <label>–ú–µ—Å—è—Ü–µ–≤ –≤ –≥–æ–¥—É:</label>
              <input type="number" id="monthsPerYear" value="12" min="1" max="24" />
            </div>
            <div class="setting-item">
              <label>–î–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ:</label>
              <input type="number" id="daysPerMonth" value="30" min="1" max="60" />
            </div>
            <div class="setting-item">
              <label>–°–µ–∫—É–Ω–¥ –≤ –¥–Ω–µ:</label>
              <input type="number" id="secondsPerDay" value="30" min="1" max="3600" />
            </div>
          </div>
          <button id="updateSettingsBtn" style="margin-top: 10px">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>

          <div style="margin-top: 20px">
            <h4>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –≤—Ä—É—á–Ω—É—é</h4>
            <div style="display: flex; gap: 10px">
              <input type="number" id="setYear" value="1" min="1" placeholder="–ì–æ–¥" />
              <input type="number" id="setMonth" value="1" min="1" placeholder="–ú–µ—Å—è—Ü" />
              <input type="number" id="setDay" value="1" min="1" placeholder="–î–µ–Ω—å" />
              <button id="setDateBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>
          </div>
        </div>
      </div>

      <!-- –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ -->
      <div class="card" id="tasksCard" style="display: none">
        <h2>‚è±Ô∏è –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏</h2>
        <div class="task-panel">
          <input type="number" id="taskDelay" value="10" min="1" max="300" placeholder="–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫)" style="width: 120px" />
          <input type="text" id="taskMessage" value="–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" style="flex: 1" />
          <button id="createTaskBtn">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
        <div class="task-list" id="taskList"></div>

        <div style="margin-top: 20px">
          <button id="getPlayerEventsBtn">–ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ —Å–æ–±—ã—Ç–∏—è</button>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="card" id="statsCard" style="display: none">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ TimeManager</h2>
        <div class="stats-grid" id="statsGrid">
          <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <button id="getStatsBtn" style="margin-top: 15px">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      </div>

      <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
      <div class="card">
        <h2>üìù –°–æ–æ–±—â–µ–Ω–∏—è</h2>
        <button id="clearMessages">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div id="messages"></div>
      </div>
    </div>

    <script>
      let socket = null;
      let isAuthenticated = false;
      let currentDate = { year: 1, month: 1, day: 1 };
      let calendarSettings = { monthsPerYear: 12, daysPerMonth: 30, secondsPerDay: 30 };
      let nextDayTime = null;
      let tasks = new Map();

      // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
      const serverUrl = document.getElementById("serverUrl");
      const connectBtn = document.getElementById("connectBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");
      const connectionStatus = document.getElementById("connectionStatus");
      const messages = document.getElementById("messages");
      const authCard = document.getElementById("authCard");
      const calendarCard = document.getElementById("calendarCard");
      const tasksCard = document.getElementById("tasksCard");
      const statsCard = document.getElementById("statsCard");
      const calendarDisplay = document.getElementById("calendarDisplay");
      const lastUpdate = document.getElementById("lastUpdate");
      const nextDayCountdown = document.getElementById("nextDayCountdown");
      const totalDays = document.getElementById("totalDays");
      const taskList = document.getElementById("taskList");
      const statsGrid = document.getElementById("statsGrid");

      // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
      function addMessage(text, type = "info") {
        const msg = document.createElement("div");
        msg.className = `message ${type}`;
        msg.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
        messages.insertBefore(msg, messages.firstChild);

        while (messages.children.length > 50) {
          messages.removeChild(messages.lastChild);
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
      function updateCalendarDisplay() {
        calendarDisplay.textContent = `–ì–æ–¥ ${currentDate.year}, –ú–µ—Å—è—Ü ${currentDate.month}, –î–µ–Ω—å ${currentDate.day}`;

        // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
        const total =
          (currentDate.year - 1) * calendarSettings.monthsPerYear * calendarSettings.daysPerMonth +
          (currentDate.month - 1) * calendarSettings.daysPerMonth +
          currentDate.day;
        totalDays.textContent = total;
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
      function updateCountdown() {
        if (nextDayTime) {
          const remaining = Math.max(0, Math.floor((nextDayTime - Date.now()) / 1000));
          nextDayCountdown.textContent = `${remaining} —Å–µ–∫`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä—ã –∑–∞–¥–∞—á
        tasks.forEach((task, id) => {
          const remaining = Math.max(0, Math.floor((task.executeAt - Date.now()) / 1000));
          const countdownEl = document.getElementById(`countdown-${id}`);
          if (countdownEl) {
            countdownEl.textContent = `${remaining} —Å–µ–∫`;
          }
          if (remaining === 0) {
            tasks.delete(id);
            updateTaskList();
          }
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á
      function updateTaskList() {
        taskList.innerHTML = "";
        tasks.forEach((task, id) => {
          const item = document.createElement("div");
          item.className = "task-item";
          item.innerHTML = `
            <span><strong>${task.name}:</strong> ${task.message}</span>
            <span class="countdown" id="countdown-${id}">-</span>
            <button onclick="cancelTask('${id}')">–û—Ç–º–µ–Ω–∏—Ç—å</button>
          `;
          taskList.appendChild(item);
        });
      }

      // –û—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏
      window.cancelTask = function (eventId) {
        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(
            JSON.stringify({
              action: "time/cancelTask",
              data: { eventId },
            })
          );
        }
      };

      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
      connectBtn.addEventListener("click", () => {
        const url = serverUrl.value;
        if (!url) {
          addMessage("–í–≤–µ–¥–∏—Ç–µ URL —Å–µ—Ä–≤–µ—Ä–∞", "error");
          return;
        }

        try {
          socket = new WebSocket(url);

          socket.onopen = () => {
            connectionStatus.textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
            connectionStatus.className = "status connected";
            connectBtn.disabled = true;
            disconnectBtn.disabled = false;
            authCard.style.display = "block";
            addMessage("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É", "success");
          };

          socket.onclose = () => {
            connectionStatus.textContent = "–û—Ç–∫–ª—é—á–µ–Ω–æ";
            connectionStatus.className = "status disconnected";
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
            authCard.style.display = "none";
            calendarCard.style.display = "none";
            tasksCard.style.display = "none";
            statsCard.style.display = "none";
            isAuthenticated = false;
            addMessage("–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞", "error");
          };

          socket.onmessage = (event) => {
            try {
              const message = JSON.parse(event.data);
              handleMessage(message);
            } catch (e) {
              console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:", e);
            }
          };

          socket.onerror = (error) => {
            addMessage(`–û—à–∏–±–∫–∞ WebSocket`, "error");
          };
        } catch (error) {
          addMessage(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error}`, "error");
        }
      });

      // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
      disconnectBtn.addEventListener("click", () => {
        if (socket) {
          socket.close();
        }
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      function handleMessage(message) {
        const { action, data, success } = message;

        // –û–±—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        if (success === false) {
          addMessage(`–û—à–∏–±–∫–∞ ${action}: ${data?.message || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`, "error");
          return;
        }

        switch (action) {
          case "system/connect":
            addMessage(data.message, "success");
            break;

          case "auth/loginSuccess":
            isAuthenticated = true;
            authCard.style.display = "none";
            calendarCard.style.display = "block";
            tasksCard.style.display = "block";
            statsCard.style.display = "block";
            addMessage(`–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ${data.player.username}`, "success");
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            socket.send(JSON.stringify({ action: "time/getDate" }));
            socket.send(JSON.stringify({ action: "time/getStats" }));
            break;

          case "auth/loginFailed":
            addMessage(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${data.message}`, "error");
            break;

          case "time/getDate":
            if (success) {
              currentDate = { year: data.year, month: data.month, day: data.day };
              calendarSettings = data.settings;
              lastUpdate.textContent = new Date(data.lastUpdate).toLocaleTimeString();
              nextDayTime = Date.now() + calendarSettings.secondsPerDay * 1000;

              // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
              document.getElementById("monthsPerYear").value = calendarSettings.monthsPerYear;
              document.getElementById("daysPerMonth").value = calendarSettings.daysPerMonth;
              document.getElementById("secondsPerDay").value = calendarSettings.secondsPerDay;

              updateCalendarDisplay();
              addMessage("–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "success");
            }
            break;

          case "game/dateUpdate":
            currentDate = { year: data.year, month: data.month, day: data.day };
            lastUpdate.textContent = new Date(data.timestamp).toLocaleTimeString();
            nextDayTime = Date.now() + data.nextDayIn * 1000;
            updateCalendarDisplay();
            addMessage(`–ù–æ–≤—ã–π –¥–µ–Ω—å! –ì–æ–¥ ${data.year}, –ú–µ—Å—è—Ü ${data.month}, –î–µ–Ω—å ${data.day}`, "success");
            break;

          case "time/getCycleStats":
            if (success) {
              addMessage(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è: ${data.totalDays} –¥–Ω–µ–π –ø—Ä–æ–π–¥–µ–Ω–æ`, "success");
            }
            break;

          case "time/setCalendarSettings":
            if (success) {
              addMessage("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã!", "success");
              socket.send(JSON.stringify({ action: "time/getDate" }));
            }
            break;

          case "time/setDate":
            if (success) {
              addMessage(`–î–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: –ì–æ–¥ ${data.year}, –ú–µ—Å—è—Ü ${data.month}, –î–µ–Ω—å ${data.day}`, "success");
              socket.send(JSON.stringify({ action: "time/getDate" }));
            }
            break;

          case "time/createTestTask":
            if (success) {
              const task = {
                name: "testTask",
                message: document.getElementById("taskMessage").value,
                executeAt: Date.now() + data.delay * 1000,
              };
              tasks.set(data.eventId, task);
              updateTaskList();
              addMessage(`–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ${data.eventId}`, "success");
            }
            break;

          case "time/testTaskComplete":
            addMessage(`‚úÖ ${data.message}`, "success");
            break;

          case "time/cancelTask":
            if (success) {
              tasks.delete(data.eventId);
              updateTaskList();
              addMessage("–ó–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞", "success");
            }
            break;

          case "time/getPlayerEvents":
            if (success) {
              addMessage(`–£ –≤–∞—Å ${data.count} –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π`, "success");
              console.log("–°–æ–±—ã—Ç–∏—è:", data.events);
            }
            break;

          case "time/getStats":
            if (success) {
              updateStatsDisplay(data);
            }
            break;

          default:
            console.log("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:", message);
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      function updateStatsDisplay(stats) {
        statsGrid.innerHTML = "";

        const items = [
          { label: "–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è", value: stats.periodicEvents || 0 },
          { label: "–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è", value: stats.onceEvents || 0 },
          { label: "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ", value: stats.pausedEvents || 0 },
          { label: "Buckets", value: stats.buckets || 0 },
        ];

        items.forEach((item) => {
          const div = document.createElement("div");
          div.className = "stat-item";
          div.innerHTML = `
            <div style="font-size: 12px; color: #666;">${item.label}</div>
            <div style="font-size: 18px; font-weight: bold; color: #333;">${item.value}</div>
          `;
          statsGrid.appendChild(div);
        });

        addMessage("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "success");
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      document.getElementById("loginBtn").addEventListener("click", () => {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        if (!email || !password) {
          addMessage("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å", "error");
          return;
        }

        socket.send(
          JSON.stringify({
            action: "auth/login",
            data: { email, password },
          })
        );
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
      document.getElementById("getDateBtn").addEventListener("click", () => {
        socket.send(JSON.stringify({ action: "time/getDate" }));
      });

      document.getElementById("getCycleStatsBtn").addEventListener("click", () => {
        socket.send(JSON.stringify({ action: "time/getCycleStats" }));
      });

      document.getElementById("updateSettingsBtn").addEventListener("click", () => {
        const monthsPerYear = parseInt(document.getElementById("monthsPerYear").value);
        const daysPerMonth = parseInt(document.getElementById("daysPerMonth").value);
        const secondsPerDay = parseInt(document.getElementById("secondsPerDay").value);

        socket.send(
          JSON.stringify({
            action: "time/setCalendarSettings",
            data: { monthsPerYear, daysPerMonth, secondsPerDay },
          })
        );
      });

      document.getElementById("setDateBtn").addEventListener("click", () => {
        const year = parseInt(document.getElementById("setYear").value);
        const month = parseInt(document.getElementById("setMonth").value);
        const day = parseInt(document.getElementById("setDay").value);

        socket.send(
          JSON.stringify({
            action: "time/setDate",
            data: { year, month, day },
          })
        );
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–¥–∞—á
      document.getElementById("createTaskBtn").addEventListener("click", () => {
        const delay = parseInt(document.getElementById("taskDelay").value);
        const message = document.getElementById("taskMessage").value;

        socket.send(
          JSON.stringify({
            action: "time/createTestTask",
            data: { delay, message },
          })
        );
      });

      document.getElementById("getPlayerEventsBtn").addEventListener("click", () => {
        socket.send(JSON.stringify({ action: "time/getPlayerEvents" }));
      });

      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      document.getElementById("getStatsBtn").addEventListener("click", () => {
        socket.send(JSON.stringify({ action: "time/getStats" }));
      });

      // –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
      document.getElementById("clearMessages").addEventListener("click", () => {
        messages.innerHTML = "";
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
      setInterval(updateCountdown, 1000);
    </script>
  </body>
</html>
